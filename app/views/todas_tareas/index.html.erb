			<div>
        <div class="container mt-4">
          <!-- Modal para crear tarea -->
          <div class="modal fade" id="modalNuevaTarea" tabindex="-1" aria-labelledby="modalNuevaTareaLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalNuevaTareaLabel"><%= t('tareas.nueva') %></h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                <% if @tarea && @tarea.errors.any? %>
                  <script>
                    document.addEventListener('DOMContentLoaded', function() {
                      var modal = new bootstrap.Modal(document.getElementById('modalNuevaTarea'));
                      modal.show();
                    });
                  </script>
                <% end %>
                  <%= form_with(model: @tarea || Tarea.new, url: tareas_path, local: true) do |form| %>
                      <div class="mb-3">
                      <%= form.label :titulo, t("tareas.titulo_tarea"), class: "form-label" %>
                      <%= form.text_field :titulo, class: "form-control" %>
                    </div>
                    <div class="mb-3">
                      <%= form.label :descripcion, t("tareas.descripcion"), class: "form-label" %>
                      <%= form.text_area :descripcion, class: "form-control" %>
                    </div>
                      <div class="mb-3">
                      <%= form.label :prioridad, t("tareas.prioridad"), class: "form-label" %>
                      <%= form.select :prioridad, options_for_select([
                        [ t("tareas.seleccionar"), nil],
                        [ t("tareas.baja"), 1],
                        [ t("tareas.media"), 2], 
                        [ t("tareas.alta"), 3],
                        [ t("tareas.urgente"), 4]
                      ]),
                      { prompt:  t("tareas.seleccionar"), },
                      { class: "form-select" } %>
                    </div>
                    <div class="mb-3">
                      <%= form.label :PersonaAsignada, t('tareas.persona_asignada'), class: "form-label" %>
                      <%= form.text_field :PersonaAsignada, class: "form-control" %>
                    </div>
                    <div class="mb-3">
                      <%= form.label :fecha_limite, t('tareas.fecha_limite'), class: "form-label" %>
                      <%= form.date_field :fecha_limite, class: "form-control" %>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%=t('tareas.acciones.cancelar')%></button>
                      <%= form.submit t('tareas.acciones.agregar'), class: "btn btn-primary" %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0"><%= t('tareas.todas_tareas') %></h2>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalNuevaTarea">
              <%= t('tareas.nueva') %>
            </button>
          </div>
          <div class="row">
            <% @tareas.each do |tarea| %>
              <div class="col-md-4 mb-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="card-title"><%= tarea.titulo %></h5>
                    <p class="card-text"><%= tarea.descripcion %></p>
                    <p class="card-text">
                      <small class="text-muted">
                        <%= t('tareas.fecha_limite') %> <strong><%= tarea.fecha_limite %></strong>
                        <% if tarea.PersonaAsignada.present? %> | <%= t('tareas.asignada_a') %> <strong><%= tarea.PersonaAsignada %></strong><% end %>
                      </small>
                    </p>
                    <% if tarea.completada %>
                      <span class="badge bg-success"><%=t('tareas.completada')%></span>
                    <% else %>
                      <span class="badge bg-warning text-dark"><%=t('tareas.pendiente')%></span>
                    <% end %>
                    <% if tarea.completada && tarea.descripcion_completado.present? %>
                      <div class="alert alert-success mt-2">
                        <strong>Descripción de lo realizado:</strong>
                        <p><%= tarea.descripcion_completado %></p>
                      </div>
                    <% end %>
                  </div>
                
                  <div class="card-footer">
                    <% unless tarea.completada %>
                      <button type="button" class="btn btn-success text-light" data-bs-toggle="modal" data-bs-target="#modalCompletarTarea" data-tarea-id="<%= tarea.id %>">
                        <%= t('tareas.acciones.completar') %>
                      </button>
                    <% end %>
                    <%= link_to t('tareas.acciones.editar'), edit_tarea_path(tarea), class: "btn btn-secondary text-light" %>
                    <%= link_to t('tareas.acciones.eliminar'), tarea_path(tarea), method: :delete, data: { confirm: "Confirmar Elminación" }, class: "btn btn-danger text-light" %>
                  </div>
                  <% if tarea.prioridad.present? %>
                    <div class="card-footer">
                      <span class="badge <%= tarea.prioridad_clase %>">
                        <%= tarea.prioridad_texto %>
                      </span> 
                    </div>
                  <% end %> 
                </div> 
              </div>
            <% end %>
            <div class="modal fade" id="modalCompletarTarea" tabindex="-1" aria-labelledby="modalCompletarTareaLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="modalCompletarTareaLabel">Completar tarea</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                  </div>
                  <div class="modal-body">
                   <%= form_with url: "", method: :patch, local: true, id: "formCompletarTarea" do |form| %>
                    <div class="mb-3">
                      <label for="descripcion_completado" class="form-label">¿Qué se realizó en la tarea?</label>
                      <textarea name="descripcion_completado" id="descripcion_completado" class="form-control" required></textarea>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-success" id="btnCompletarTarea" disabled>Completar</button>
                    </div>
                  <% end %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            var modal = document.getElementById('modalCompletarTarea');
            var form = document.getElementById('formCompletarTarea');
            var btn = document.getElementById('btnCompletarTarea');
            var textarea = document.getElementById('descripcion_completado');

            if (modal && form && btn) {
              modal.addEventListener('show.bs.modal', function (event) {
                var button = event.relatedTarget;
                var tareaId = button.getAttribute('data-tarea-id');
                form.action = '/tareas/' + tareaId + '/completar';
                btn.disabled = false;
                if (textarea) textarea.value = "";
              });

              form.addEventListener('submit', function(e) {
                if (!form.action || form.action === "" || form.action.endsWith('/tareas_pendientes')) {
                  e.preventDefault();
                  alert('Error: No se pudo identificar la tarea a completar. Intenta de nuevo.');
                }
              });

              modal.addEventListener('hidden.bs.modal', function () {
                btn.disabled = true;
                form.action = "";
                if (textarea) textarea.value = "";
              });
            }
          });
        </script>